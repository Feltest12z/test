-- ==========================================================
--  FelixzUI - Core Library (Full Source Code)
--  Version: 2.0 (with Advanced Theming and Particles)
-- ==========================================================

local FelixzUI = {}
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Debris = game:GetService("Debris")
local CoreGui = game:GetService("CoreGui")

-- ğŸ¨ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙˆØªØ®Ø²ÙŠÙ† Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
getgenv().CurrentTheme = {
    Accent = Color3.fromRGB(35, 35, 45),
    Hover = Color3.fromRGB(60, 60, 80),
    Highlight = Color3.fromRGB(100, 120, 255),
    Text = Color3.fromRGB(235, 235, 245),
    Background = Color3.fromRGB(20, 20, 24),
    Border = Color3.fromRGB(70, 70, 85),
    Shadow = Color3.fromRGB(6, 6, 10),
    Glow = Color3.fromRGB(0, 200, 255)
}
getgenv().ThemeUpdatables = {} -- Ù„ØªØ®Ø²ÙŠÙ† Ø¯ÙˆØ§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± (Ø§Ù„ÙƒØ±ÙˆØªØŒ Ø§Ù„Ø£Ø²Ø±Ø§Ø±ØŒ Ø¥Ù„Ø®)
getgenv().ExtraThemeFunctions = {} -- Ù„ØªØ®Ø²ÙŠÙ† Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ø«Ù„ makePage)

local window, sidebar, content, activeTab, currentPage, buttons, pages, uiScale
buttons = {}
pages = {}
local tabs = {} -- ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù„Ø³Ù†Ø©

-- ğŸ¨ Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø«ÙŠÙ…
local function getTheme()
    return getgenv().CurrentTheme
end

-- ğŸ“ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… CanvasSize Ù„Ù„Ù€ ScrollingFrames
local function refreshScrollFrames()
    local scale = uiScale and uiScale.Scale or 1
    for _, frame in pairs(window:GetDescendants()) do
        if frame:IsA("ScrollingFrame") then
            -- Ù†Ø³ØªØ®Ø¯Ù… AutomaticCanvasSize.Y Ø¹Ø§Ø¯Ø©Ù‹ØŒ Ù„ÙƒÙ† Ù‡Ø°Ù‡ ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ø´Ø§Ù…Ù„Ø©
            if frame.AutomaticCanvasSize ~= Enum.AutomaticSize.Y then
                local layout = frame:FindFirstChildOfClass("UIListLayout") or frame:FindFirstChildOfClass("UIGridLayout")
                if layout then
                    local contentY = layout.AbsoluteContentSize.Y * (1 / scale)
                    -- Ù†Ø³ØªØ®Ø¯Ù… math.max Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§Ø­Ø© ÙØ§Ø±ØºØ© Ø³Ù„Ø¨ÙŠØ©
                    frame.CanvasSize = UDim2.new(0, 0, 0, math.max(contentY + 20, 0)) 
                end
            end
        end
    end
end

-- ğŸ”” Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Notify)
function FelixzUI:Notify(Title, Text, Duration, Icon, ColorType)
    -- Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù‡Ù†Ø§ØŒ Ù„ÙƒÙ† ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªÙ…Ù„Ùƒ Ø¯Ø§Ù„Ø© Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© ØªØ¹Ù…Ù„.
    -- Ù‡Ø°Ø§ Ù…Ø¬Ø±Ø¯ Placeholder Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ.
    print(string.format("[Notify] %s: %s", Title, Text))
end

-- ğŸ”„ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
local function updateTheme()
    local theme = getTheme()
    if not theme or not window then return end

    -- ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    for name, btn in pairs(buttons or {}) do
        if btn then
            btn.TextColor3 = theme.Text
            btn.BackgroundColor3 = (btn == activeTab) and theme.Highlight or theme.Accent
            local stroke = btn:FindFirstChildOfClass("UIStroke")
            if stroke then stroke.Color = theme.Border end
            local arrow = btn:FindFirstChild("Arrow")
            if arrow then
                arrow.TextColor3 = theme.Text
                arrow.Visible = (btn == activeTab)
            end
            local glow = btn:FindFirstChild("Glow")
            if glow and glow:IsA("ImageLabel") then glow.ImageColor3 = theme.Glow end
        end
    end

    -- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    if content then content.BackgroundColor3 = theme.Background end
    if sidebar then 
        sidebar.BackgroundColor3 = theme.Accent
        local stroke = sidebar:FindFirstChildOfClass("UIStroke")
        if stroke then stroke.Color = theme.Border end
    end
    local titleBar = window:FindFirstChild("TitleBar") or window:FindFirstChild("titleBar")
    if titleBar then 
        titleBar.BackgroundColor3 = theme.Accent
        local stroke = titleBar:FindFirstChildOfClass("UIStroke")
        if stroke then stroke.Color = theme.Border end
    end
    local shadow = window:FindFirstChild("Shadow") or window:FindFirstChild("WindowShadow")
    if shadow and shadow:IsA("ImageLabel") then shadow.ImageColor3 = theme.Shadow end

    -- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙØ±Ø¹ÙŠØ© (Ø§Ù„ÙƒØ±ÙˆØªØŒ Ø§Ù„Ø£Ø²Ø±Ø§Ø±ØŒ Ø§Ù„ØªÙˆØ¬Ù„Ø§Øª)
    if getgenv().ExtraThemeFunctions then
        for _, fn in ipairs(getgenv().ExtraThemeFunctions) do pcall(fn) end
    end

    if getgenv().ThemeUpdatables then
        for _, fn in ipairs(getgenv().ThemeUpdatables) do pcall(fn, theme) end
    end
    
    -- ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰
    for _, p in pairs(pages) do
        p.BackgroundColor3 = theme.Background
    end
end
FelixzUI.UpdateTheme = updateTheme

-- ====== makePage (Ù„Ø¥Ù†Ø´Ø§Ø¡ Tab Content) ======
local function makePage(name)
    local theme = getTheme()
    local p = Instance.new("Frame")
    p.Name = name .. "Page"
    p.Size = UDim2.fromScale(1, 1)
    p.BackgroundColor3 = theme.Background
    p.BorderSizePixel = 0
    p.Visible = false
    p.Parent = content
    Instance.new("UICorner", p).CornerRadius = UDim.new(0, 12)

    -- ğŸŸ¢ ScrollFrame Ù…Ø­Ø³Ù‘Ù†
    local scroll = Instance.new("ScrollingFrame")
    scroll.Name = "ContentScroll"
    scroll.Size = UDim2.new(1, -10, 1, -10)
    scroll.Position = UDim2.new(0, 5, 0, 5)
    scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    scroll.ScrollBarThickness = 6
    scroll.BackgroundTransparency = 0.4
    scroll.BackgroundColor3 = theme.Background
    scroll.ScrollBarImageColor3 = theme.Glow or theme.Highlight -- Ù„ÙˆÙ† Ø§Ù„Ø´Ø±ÙŠØ·
    scroll.ScrollingDirection = Enum.ScrollingDirection.Y
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scroll.Parent = p

    -- ğŸ§© Padding
    local padding = Instance.new("UIPadding", scroll)
    padding.PaddingLeft = UDim.new(0, 8)
    padding.PaddingRight = UDim.new(0, 8)
    padding.PaddingTop = UDim.new(0, 8)
    padding.PaddingBottom = UDim.new(0, 8)

    -- ğŸ§± Layout Ù…Ù†Ø¸Ù…
    local layout = Instance.new("UIListLayout", scroll)
    layout.Padding = UDim.new(0, 8)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

    -- ğŸ”„ Ø¥Ø¯Ø±Ø§Ø¬ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡
    table.insert(getgenv().ExtraThemeFunctions, function()
        local t = getTheme()
        if scroll then
            scroll.ScrollBarImageColor3 = t.Glow or t.Highlight
            scroll.BackgroundColor3 = t.Background
        end
        p.BackgroundColor3 = t.Background
    end)
    
    task.defer(refreshScrollFrames) -- ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ„ÙŠ

    return p, scroll
end

-- ====== makeTabButton (Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù„Ø³Ù†Ø©) ======
local function makeTabButton(name, icon, order)
    local theme = getTheme()

    local btn = Instance.new("TextButton")
    btn.Name = name .. "Button"
    btn.LayoutOrder = order
    btn.Size = UDim2.new(1, -10, 0, 40)
    btn.Position = UDim2.new(0.5, 0, 0, 0)
    btn.AnchorPoint = Vector2.new(0.5, 0)
    btn.Text = name
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.TextColor3 = theme.Text
    btn.BackgroundColor3 = theme.Accent
    btn.AutoButtonColor = false
    btn.BorderSizePixel = 0
    btn.Parent = sidebar
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

    -- Icon
    if icon then
        local img = Instance.new("ImageLabel")
        img.Size = UDim2.new(0, 24, 0, 24)
        img.Position = UDim2.new(0, 8, 0.5, 0)
        img.AnchorPoint = Vector2.new(0, 0.5)
        img.Image = icon
        img.ImageColor3 = theme.Text
        img.BackgroundTransparency = 1
        img.Parent = btn
        
        -- ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù†Øµ Ù„ÙˆØ¬ÙˆØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø©
        btn.TextXAlignment = Enum.TextXAlignment.Left
        btn.TextLabel:SetAttribute("TextOffset", UDim2.new(0, 36, 0, 0)) -- Ù„Ø§ ÙŠØ¹Ù…Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù‡ÙƒØ°Ø§ØŒ ÙŠØªØ·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ
        -- Ø­Ù„ Ø¨Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ù… TextLabel Ù…Ù†ÙØµÙ„ Ø£Ùˆ Ø£Ø²ÙØ­ Ø§Ù„Ù†Øµ ÙŠØ¯ÙˆÙŠØ§Ù‹
        btn.TextLabel:TweenPosition(UDim2.new(0, 36, 0, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.1, true)
    end
    
    -- Arrow Indicator
    local arrow = Instance.new("TextLabel")
    arrow.Name = "Arrow"
    arrow.Size = UDim2.new(0, 10, 1, 0)
    arrow.Position = UDim2.new(1, -10, 0, 0)
    arrow.Text = "Â»"
    arrow.Font = Enum.Font.Code
    arrow.TextSize = 24
    arrow.TextColor3 = theme.Text
    arrow.BackgroundTransparency = 1
    arrow.Visible = false
    arrow.Parent = btn

    local function setActive()
        if activeTab == btn then return end

        -- Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ…
        if activeTab then
            TweenService:Create(activeTab, TweenInfo.new(0.25), {
                BackgroundColor3 = theme.Accent
            }):Play()
            if currentPage then currentPage.Visible = false end
            local oldArrow = activeTab:FindFirstChild("Arrow")
            if oldArrow then oldArrow.Visible = false end
        end

        -- Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
        activeTab = btn
        currentPage = pages[name]
        currentPage.Visible = true

        TweenService:Create(btn, TweenInfo.new(0.25), {
            BackgroundColor3 = theme.Highlight
        }):Play()
        
        arrow.Visible = true
        
        refreshScrollFrames() -- ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰

        -- Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù€ Hover Ù…Ù† Ø§Ù„Ø²Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…
        local oldHover = activeTab.BackgroundColor3:Lerp(theme.Hover, 0) -- trick to force update
    end

    btn.MouseButton1Click:Connect(setActive)
    
    -- Hover effect
    btn.MouseEnter:Connect(function()
        if activeTab ~= btn then
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = theme.Hover}):Play()
        end
    end)
    btn.MouseLeave:Connect(function()
        if activeTab ~= btn then
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = theme.Accent}):Play()
        end
    end)
    
    return btn
end

-- ğŸŸ¥ makeCard (Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø·Ø¹ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨)
function makeCard(scroll, titleText)
    local theme = getTheme()

    local card = Instance.new("Frame")
    card.Size = UDim2.new(1, 0, 0, 0) -- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Size Ø¨Ø§Ù„Ù€ Scale 1
    card.AutomaticSize = Enum.AutomaticSize.Y
    card.BackgroundColor3 = theme.Accent
    card.BorderSizePixel = 0
    card.BackgroundTransparency = 0.08
    card.ClipsDescendants = true
    card.Parent = scroll
    Instance.new("UICorner", card).CornerRadius = UDim.new(0, 12)

    -- ğŸ”¹ Ø§Ù„Ø¸Ù„
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "CardShadow"
    shadow.AnchorPoint = Vector2.new(0.5, 0.5)
    shadow.Position = UDim2.fromScale(0.5, 0.5)
    shadow.Size = UDim2.new(1, 22, 1, 22)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = theme.Shadow
    shadow.ImageTransparency = 0.82
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.ZIndex = 0
    shadow.Parent = card

    -- ğŸ”¹ Ø§Ù„Ø¥Ø·Ø§Ø±
    local stroke = Instance.new("UIStroke")
    stroke.Parent = card
    stroke.Color = theme.Border
    stroke.Thickness = 1
    stroke.Transparency = 0.45

    -- ğŸ”¹ ØªØ¯Ø±Ø¬ Ø¯Ø§Ø®Ù„ÙŠ
    local gradient = Instance.new("UIGradient")
    gradient.Parent = card
    gradient.Rotation = 45
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, theme.Accent),
        ColorSequenceKeypoint.new(1, theme.Background)
    }

    -- ğŸ” Ø­Ø±ÙƒØ© Ø§Ù„ØªØ¯Ø±Ø¬
    local gradientLoop = task.spawn(function()
        while card and card.Parent do
            for i = 0, 1, 0.02 do
                if gradient and gradient.Parent then
                    gradient.Offset = Vector2.new(i, i)
                else break end
                task.wait(0.06)
            end
        end
    end)

    -- ğŸ”¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    local title = Instance.new("TextLabel")
    title.Name = "CardTitle"
    title.Text = titleText or "Section"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.TextColor3 = theme.Text
    title.BackgroundTransparency = 1
    title.Size = UDim2.new(1, -20, 0, 28)
    title.Position = UDim2.new(0, 12, 0, 8)
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = card

    -- ğŸ”¹ Ø§Ù„Ø®Ø· Ø§Ù„Ø³ÙÙ„ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ 50 Ø¨ÙƒØ³Ù„)
    local underline = Instance.new("Frame")
    underline.Name = "CardUnderline"
    underline.Size = UDim2.new(0, 50, 0, 2)
    underline.Position = UDim2.new(0, 12, 0, 38)
    underline.BackgroundColor3 = theme.Highlight
    underline.BorderSizePixel = 0
    underline.Parent = card

    -- ğŸ”¹ Ø§Ù„ÙØ§ØµÙ„
    local divider = Instance.new("Frame")
    divider.Name = "CardDivider"
    divider.Size = UDim2.new(1, -24, 0, 1)
    divider.Position = UDim2.new(0, 12, 0, 40)
    divider.BackgroundColor3 = theme.Border
    divider.BackgroundTransparency = 0.45
    divider.BorderSizePixel = 0
    divider.Parent = card

    -- ğŸ”¹ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    local items = Instance.new("Frame")
    items.Name = "CardItems"
    items.Size = UDim2.new(1, -24, 0, 0)
    items.Position = UDim2.new(0, 12, 0, 50)
    items.BackgroundTransparency = 1
    items.AutomaticSize = Enum.AutomaticSize.Y
    items.Parent = card

    local ilayout = Instance.new("UIListLayout")
    ilayout.Padding = UDim.new(0, 8)
    ilayout.SortOrder = Enum.SortOrder.LayoutOrder
    ilayout.Parent = items

    -- âœ¨ Ø¯Ø®ÙˆÙ„ Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
    card.BackgroundTransparency = 1
    TweenService:Create(card, TweenInfo.new(0.45, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        BackgroundTransparency = 0.08
    }):Play()

    -- ğŸ”¹ Hover effect
    card.MouseEnter:Connect(function()
        local th = getTheme()
        TweenService:Create(card, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {BackgroundColor3 = th.Hover}):Play()
        -- ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ø®Ø· Ø§Ù„Ø³ÙÙ„ÙŠ
        TweenService:Create(underline, TweenInfo.new(0.25, Enum.EasingStyle.Back), {Size = UDim2.new(1, -24, 0, 2)}):Play()
        TweenService:Create(shadow, TweenInfo.new(0.2), {ImageTransparency = 0.7}):Play()
    end)

    card.MouseLeave:Connect(function()
        local th = getTheme()
        TweenService:Create(card, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {BackgroundColor3 = th.Accent}):Play()
        -- ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ø§Ù„Ø³ÙÙ„ÙŠ
        TweenService:Create(underline, TweenInfo.new(0.25, Enum.EasingStyle.Quad), {Size = UDim2.new(0, 50, 0, 2)}):Play()
        TweenService:Create(shadow, TweenInfo.new(0.2), {ImageTransparency = 0.82}):Play()
    end)

    -- âœ¨ Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ù…Ø«Ù„Ø«Ø§Øª Ø§Ù„Ù…Ø¶ÙŠØ¦Ø©
    local particleFrame = Instance.new("Frame")
    particleFrame.Size = UDim2.fromScale(1, 1)
    particleFrame.BackgroundTransparency = 1
    particleFrame.ClipsDescendants = true
    particleFrame.ZIndex = 0
    particleFrame.Parent = card

    local particleLoop = task.spawn(function()
        while particleFrame and particleFrame.Parent do
            local th = getTheme()
            local tri = Instance.new("ImageLabel")
            local size = math.random(25, 40)
            tri.Size = UDim2.fromOffset(size, size)
            tri.Position = UDim2.new(math.random(), 0, math.random(), 0)
            tri.BackgroundTransparency = 1
            tri.Image = "rbxassetid://6031091004" -- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø«Ù„Ø«
            tri.ImageColor3 = th.Glow
            tri.ImageTransparency = 0.6
            tri.Rotation = math.random(0, 360)
            tri.ZIndex = 0
            tri.Parent = particleFrame

            TweenService:Create(tri, TweenInfo.new(5, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                Position = UDim2.new(tri.Position.X.Scale + math.random(-1, 1)/50, 0, tri.Position.Y.Scale - math.random(5, 10)/100, 0),
                Rotation = tri.Rotation + math.random(-60, 60),
                ImageTransparency = 1
            }):Play()

            Debris:AddItem(tri, 5.5)
            task.wait(0.5)
        end
    end)

    -- ğŸ”¹ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø«ÙŠÙ…
    local function updateCardTheme()
        local th = getTheme()
        if not card or not card.Parent then return end
        
        card.BackgroundColor3 = th.Accent
        title.TextColor3 = th.Text
        divider.BackgroundColor3 = th.Border
        underline.BackgroundColor3 = th.Highlight
        shadow.ImageColor3 = th.Shadow
        stroke.Color = th.Border
        
        gradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, th.Accent),
            ColorSequenceKeypoint.new(1, th.Background)
        }
        
        for _, tri in ipairs(particleFrame:GetChildren()) do
            if tri:IsA("ImageLabel") then tri.ImageColor3 = th.Glow end
        end
    end

    table.insert(getgenv().ThemeUpdatables, updateCardTheme)

    -- ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¯Ù…ÙŠØ±
    card.Destroying:Connect(function()
        if gradientLoop then task.cancel(gradientLoop) end
        if particleLoop then task.cancel(particleLoop) end
        -- Ø¥Ø²Ø§Ù„Ø© Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«
        local updatables = getgenv().ThemeUpdatables
        for i, func in ipairs(updatables) do
            if func == updateCardTheme then
                table.remove(updatables, i)
                break
            end
        end
    end)

    return card, items
end

-- ğŸŸ¢ makeToggle (Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„)
local function makeToggle(container, data)
    local theme = getTheme()
    local state = data.Default or false
    
    local item = Instance.new("Frame")
    item.Size = UDim2.new(1, 0, 0, 30)
    item.BackgroundTransparency = 1
    item.Parent = container

    -- ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    local title = Instance.new("TextLabel")
    title.Text = data.Name or "Toggle"
    title.TextSize = 14
    title.Font = Enum.Font.GothamBold
    title.TextColor3 = theme.Text
    title.BackgroundTransparency = 1
    title.Size = UDim2.new(1, -40, 1, 0)
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = item

    -- ğŸ”˜ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Button part)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 48, 0, 24)
    btn.Position = UDim2.new(1, 0, 0.5, 0)
    btn.AnchorPoint = Vector2.new(1, 0.5)
    btn.BackgroundColor3 = state and theme.Highlight or theme.Accent
    btn.BorderSizePixel = 0
    btn.AutoButtonColor = false
    btn.Text = ""
    btn.Parent = item
    Instance.new("UICorner", btn).CornerRadius = UDim.new(1, 0)
    
    -- ğŸŸ  Ù…Ø¤Ø´Ø± Ø§Ù„Ø­Ø§Ù„Ø©
    local indicator = Instance.new("Frame")
    local size = 20
    indicator.Size = UDim2.fromOffset(size, size)
    indicator.AnchorPoint = Vector2.new(0.5, 0.5)
    indicator.BackgroundColor3 = theme.Text
    indicator.BorderSizePixel = 0
    indicator.Parent = btn
    Instance.new("UICorner", indicator).CornerRadius = UDim.new(1, 0)

    -- ğŸ¨ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
    local function updateState(newState)
        state = newState
        local targetColor = state and theme.Highlight or theme.Accent
        local targetX = state and 1 or 0
        
        TweenService:Create(btn, TweenInfo.new(0.25, Enum.EasingStyle.Quad), {
            BackgroundColor3 = targetColor
        }):Play()

        TweenService:Create(indicator, TweenInfo.new(0.25, Enum.EasingStyle.Quad), {
            Position = UDim2.new(targetX, state and -3 or 3, 0.5, 0)
        }):Play()
    end
    
    -- ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø± ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
    indicator.Position = UDim2.new(state and 1 or 0, state and -3 or 3, 0.5, 0)

    -- ğŸ–±ï¸ Ø§Ù„ØªÙØ§Ø¹Ù„
    btn.MouseButton1Click:Connect(function()
        state = not state
        updateState(state)
        if data.Callback then
            data.Callback(state)
        end
    end)
    
    -- ğŸ”„ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø«ÙŠÙ…
    local function updateToggleTheme(th)
        if not item or not item.Parent then return end
        title.TextColor3 = th.Text
        indicator.BackgroundColor3 = th.Text
        if state then
            btn.BackgroundColor3 = th.Highlight
        else
            btn.BackgroundColor3 = th.Accent
        end
    end
    table.insert(getgenv().ThemeUpdatables, updateToggleTheme)

    return item, updateState
end

-- ğŸ”˜ makeButton (Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ)
local function makeButton(container, text, callback, sizeX)
    local theme = getTheme()
    sizeX = sizeX or 120

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, sizeX, 0, 36)
    btn.Text = text or "Button"
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.TextColor3 = theme.Text
    btn.BackgroundColor3 = theme.Accent
    btn.AutoButtonColor = false
    btn.BorderSizePixel = 0
    btn.ClipsDescendants = true
    btn.Parent = container
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

    -- Stroke Ù…Ø­Ø³Ù‘Ù†
    local stroke = Instance.new("UIStroke", btn)
    stroke.Color = theme.Highlight
    stroke.Thickness = 1
    stroke.Transparency = 0.5

    local isHovering = false

    -- Hover effect
    btn.MouseEnter:Connect(function()
        isHovering = true
        local th = getTheme()
        TweenService:Create(btn, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundColor3 = th.Hover,
            Size = UDim2.new(0, sizeX + 6, 0, 38)
        }):Play()
        TweenService:Create(stroke, TweenInfo.new(0.25), {
            Transparency = 0.2,
            Thickness = 1.2
        }):Play()
    end)

    btn.MouseLeave:Connect(function()
        isHovering = false
        local th = getTheme()
        TweenService:Create(btn, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundColor3 = th.Accent,
            Size = UDim2.new(0, sizeX, 0, 36)
        }):Play()
        TweenService:Create(stroke, TweenInfo.new(0.25), {
            Transparency = 0.5,
            Thickness = 1
        }):Play()
    end)

    -- ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ
    btn.MouseButton1Down:Connect(function()
        local th = getTheme()
        TweenService:Create(btn, TweenInfo.new(0.1), {
            BackgroundColor3 = th.Highlight,
            Size = UDim2.new(0, sizeX + 2, 0, 34),
            Position = UDim2.new(0, 1, 0, 1)
        }):Play()
        TweenService:Create(stroke, TweenInfo.new(0.1), {
            Transparency = 0.8
        }):Play()
    end)

    btn.MouseButton1Up:Connect(function()
        local th = getTheme()
        local targetSize = isHovering and UDim2.new(0, sizeX + 6, 0, 38) or UDim2.new(0, sizeX, 0, 36)
        local targetColor = isHovering and th.Hover or th.Accent
        local targetStrokeTrans = isHovering and 0.2 or 0.5

        TweenService:Create(btn, TweenInfo.new(0.15), {
            BackgroundColor3 = targetColor,
            Size = targetSize,
            Position = UDim2.new(0, 0, 0, 0)
        }):Play()
        TweenService:Create(stroke, TweenInfo.new(0.15), {
            Transparency = targetStrokeTrans
        }):Play()
    end)

    -- ØµÙˆØª ÙˆÙ†Ù‚Ø±Ø© ÙˆÙˆÙ…ÙŠØ¶
    btn.MouseButton1Click:Connect(function(x, y)
        if callback then callback() end
        -- Ripple Effect (ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ ÙƒÙˆØ¯Ùƒ)
        local ripple = Instance.new("Frame")
        ripple.Name = "ActiveRipple"
        ripple.AnchorPoint = Vector2.new(0.5, 0.5)
        ripple.Position = UDim2.new(0, x - btn.AbsolutePosition.X, 0, y - btn.AbsolutePosition.Y)
        ripple.Size = UDim2.fromOffset(0, 0)
        ripple.BackgroundColor3 = theme.Highlight
        ripple.BackgroundTransparency = 0.5
        ripple.ZIndex = btn.ZIndex + 5
        ripple.ClipsDescendants = true
        ripple.Parent = btn
        Instance.new("UICorner", ripple).CornerRadius = UDim.new(1, 0)
        local finalSize = math.max(btn.AbsoluteSize.X, btn.AbsoluteSize.Y) * 2.2
        local tweenIn = TweenService:Create(ripple, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, finalSize, 0, finalSize),
            BackgroundTransparency = 0.7
        })
        local tweenOut = TweenService:Create(ripple, TweenInfo.new(0.4, Enum.EasingStyle.Sine, Enum.EasingDirection.In), {
            BackgroundTransparency = 1
        })
        tweenIn:Play()
        tweenIn.Completed:Connect(function() tweenOut:Play() end)
        tweenOut.Completed:Connect(function() ripple:Destroy() end)
    end)

    -- Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¯Ø®ÙˆÙ„ Ø®ÙÙŠÙ
    task.spawn(function()
        btn.BackgroundTransparency = 1
        btn.TextTransparency = 1
        stroke.Transparency = 1

        TweenService:Create(btn, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), { BackgroundTransparency = 0 }):Play()
        TweenService:Create(btn, TweenInfo.new(0.3), { TextTransparency = 0 }):Play()
        TweenService:Create(stroke, TweenInfo.new(0.5), { Transparency = 0.5 }):Play()
    end)
    
    -- ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ø«ÙŠÙ…
    local function updateButtonTheme(th)
        if not btn or not btn.Parent then return end
        btn.BackgroundColor3 = isHovering and th.Hover or th.Accent
        btn.TextColor3 = th.Text
        stroke.Color = th.Highlight
    end
    table.insert(getgenv().ThemeUpdatables, updateButtonTheme)

    return btn
end


-- ==========================================================
-- ğŸ”¨ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (API)
-- ==========================================================

function FelixzUI:CreateWindow(config)
    -- ... (ÙƒÙˆØ¯ Ø¥Ù†Ø´Ø§Ø¡ GUI Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (ScreenGui) ÙˆØ§Ù„Ù€ Shadow ÙˆØ§Ù„Ù€ TitleBar) ...
    -- Ù†ÙØªØ±Ø¶ Ø£Ù†Ùƒ Ù‚Ù…Øª Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: gui, window, sidebar, content
    
    local gui = Instance.new("ScreenGui")
    gui.Name = config.Name or "FelixzUI"
    gui.ResetOnSpawn = false
    gui.IgnoreGuiInset = true
    gui.Parent = CoreGui
    
    -- Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    window = Instance.new("Frame", gui)
    window.Name = "Window"
    window.Size = UDim2.new(0, 600, 0, 400)
    window.Position = UDim2.fromScale(0.5, 0.5)
    window.AnchorPoint = Vector2.new(0.5, 0.5)
    window.BackgroundColor3 = getTheme().Background
    Instance.new("UICorner", window).CornerRadius = UDim.new(0, 15)
    
    -- Sidebar (Ù„Ù„Ø£Ù„Ø³Ù†Ø©)
    sidebar = Instance.new("Frame", window)
    sidebar.Name = "Sidebar"
    sidebar.Size = UDim2.new(0.3, 0, 1, 0)
    sidebar.BackgroundColor3 = getTheme().Accent
    local sidebarLayout = Instance.new("UIListLayout", sidebar)
    sidebarLayout.Padding = UDim.new(0, 5)
    sidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    sidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
    
    -- Content (Ù„Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)
    content = Instance.new("Frame", window)
    content.Name = "Content"
    content.Size = UDim2.new(0.7, 0, 1, 0)
    content.Position = UDim2.new(0.3, 0, 0, 0)
    content.BackgroundColor3 = getTheme().Background

    -- UIScale (Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø·ÙˆØ·)
    uiScale = Instance.new("UIScale", gui)
    uiScale.Scale = 1 
    
    -- Ø±Ø¨Ø· ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù€ ScrollFrames
    window:GetPropertyChangedSignal("AbsoluteSize"):Connect(refreshScrollFrames)
    uiScale:GetPropertyChangedSignal("Scale"):Connect(refreshScrollFrames)
    
    -- ğŸ”‘ KeySystem
    if config.KeySystem and config.Key then
        window.Visible = false
        -- ... (Ù‡Ù†Ø§ ÙŠØªÙ… ØªÙ†ÙÙŠØ° ÙƒÙˆØ¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­) ...
    end
    
    local self = {}
    
    function self:CreateTab(data)
        table.insert(tabs, data)
        local b = makeTabButton(data.Name, data.Icon, #tabs)
        local p, scroll = makePage(data.Name)
        buttons[data.Name] = b
        pages[data.Name] = p
        
        -- ØªÙØ¹ÙŠÙ„ Ø£ÙˆÙ„ ØªØ¨ÙˆÙŠØ¨ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ
        if #tabs == 1 then
            activeTab = b
            currentPage = p
            p.Visible = true
            b.BackgroundColor3 = getTheme().Highlight
            local arrow = b:FindFirstChild("Arrow")
            if arrow then arrow.Visible = true end
        end

        local tabAPI = {}
        
        function tabAPI:CreateSection(sectionData)
            local card, items = makeCard(scroll, sectionData.Name)
            local sectionAPI = {}
            
            function sectionAPI:Toggle(toggleData)
                makeToggle(items, toggleData)
                refreshScrollFrames()
            end
            
            function sectionAPI:Button(buttonData)
                makeButton(items, buttonData.Name, buttonData.Callback, buttonData.SizeX or 120)
                refreshScrollFrames()
            end
            
            -- ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‡Ù†Ø§ (Slider, Dropdown, etc.)
            
            return sectionAPI
        end
        
        return tabAPI
    end

    -- ğŸ”„ Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    updateTheme()

    return self
end

return FelixzUI
